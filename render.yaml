services:
  - type: web
    name: aichat
    env: node
    nodeVersion: 23.x
    rootDir: metasiberian-agent
    buildCommand: |
      curl -fsSL https://bun.sh/install | bash
      export PATH="$HOME/.bun/bin:$PATH"
      bun --version
      bun install
      # Build client first to include latest changes
      # Client is in ../packages/client relative to metasiberian-agent
      if [ -d "../packages/client" ]; then
        echo "Building client..."
        cd ../packages/client && bun run build && cd ../../metasiberian-agent
        # Copy built client to node_modules so server can use it
        if [ -d "../packages/client/dist" ] && [ -d "node_modules/@elizaos/client" ]; then
          echo "Copying client dist to node_modules..."
          cp -r ../packages/client/dist node_modules/@elizaos/client/
        fi
      fi
      bun run build
    startCommand: |
      export PATH="$HOME/.bun/bin:$PATH"
      bun run start
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 3000
      - key: SERVER_PORT
        value: 3000
      - key: OPENAI_API_KEY
        sync: false  # Установите вручную в Dashboard

